<!DOCTYPE html>
<html>
<head>
<title>プロキシリスト</title>
<script>
// ... (既存の関数)

async function openUrls() {
  const blockedUrls = getBlockedUrls();

  fetch('https://zhjpwlj.github.io/Proxylist/list.txt')
    .then(response => response.text())
    .then(data => {
      const urls = data.split('\n');

      urls.forEach(async (url, index) => {
        if (url.trim() !== '') {
          window.open(url, '_blank'); 

          // タイトルが "ブロックされました。" になるまで最大15秒待つ
          let isBlocked = false;
          await Promise.race([
            new Promise(resolve => {
              const intervalId = setInterval(() => {
                if (document.title === "ブロックされました。") {
                  clearInterval(intervalId);
                  isBlocked = true;
                  resolve();
                }
              }, 100);
            }),
            new Promise(resolve => setTimeout(resolve, 15000)) // 15秒後にタイムアウト
          ]);

          if (!isBlocked) {
            console.log(`Title did not change to "ブロックされました。" for ${url}`);
          } else {
            console.warn(`Skipping blocked URL: ${url}`);
            blockedUrls.push(url);
            setBlockedUrls(blockedUrls);
          }
        }
      });
    })
    .catch(error => {
      console.error('Error fetching data:', error);
    });
}
</script>
</head>
<body>
  <h1>Open URLs in New Tabs</h1>
  <button onclick="openUrls()">プロキシを開く</button>
</body>
</html>
