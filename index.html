<!DOCTYPE html>
<html>
<head>
<title>プロキシリスト</title>
<script>
// CookieからブロックされたURLのリストを取得する関数
function getBlockedUrls() {
  const cookies = document.cookie.split(';');
  const blockedUrlCookie = cookies.find(cookie => cookie.startsWith('blockedUrls='));
  if (blockedUrlCookie) {
    return blockedUrlCookie.split('=')[1].split(',');
  } else {
    return []; 
  }
}

// ブロックされたURLのリストをCookieに保存する関数
function setBlockedUrls(urls) {
  const expires = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000); // 1年後に有効期限切れ
  document.cookie = `blockedUrls=${urls.join(',')}; expires=${expires.toUTCString()}; path=/`;
}

// URLがブロックリストに含まれているか確認する関数
function isBlockedUrl(url, blockedUrls) {
  return blockedUrls.includes(url);
}

async function openUrls() {
  const blockedUrls = getBlockedUrls();

  fetch('https://zhjpwlj.github.io/Proxylist/list.txt')
    .then(response => response.text())
    .then(data => {
      const urls = data.split('\n');

      urls.forEach(async (url, index) => {
        if (url.trim() !== '') {
          if (document.title === "ブロックされました。" || isBlockedUrl(url, blockedUrls)) {
            console.warn(`Skipping blocked URL: ${url}`);
            blockedUrls.push(url);
            setBlockedUrls(blockedUrls);
          } else {
            // スロットリング (100ミリ秒ごとに1つのタブを開く)
            await new Promise(resolve => setTimeout(resolve, 100));
            window.open(url, '_blank');
          }
        }
      });
    })
    .catch(error => {
      console.error('Error fetching data:', error);
    });
}
</script>
</head>
<body>
  <h1>Open URLs in New Tabs</h1>
  <button onclick="openUrls()">プロキシを開く</button>
</body>
</html>
